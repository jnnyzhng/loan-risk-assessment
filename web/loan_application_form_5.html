<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loan Application Form</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        html, body {
            height: 100%;
            overflow: hidden;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        /* Main Layout */
        .main-wrapper {
            display: flex;
            height: 100vh;
            width: 100%;
            position: relative;
        }

        /* Form Panel */
        .form-panel {
            flex: 1;
            overflow-y: auto;
            padding: 40px 20px;
            transition: margin-right 0.3s ease;
        }

        /* Chatbot Toggle Tab (when closed) */
        .chatbot-tab {
            position: fixed;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            color: white;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            padding: 20px 12px;
            cursor: pointer;
            border-radius: 10px 0 0 10px;
            font-weight: 600;
            font-size: 14px;
            letter-spacing: 1px;
            box-shadow: -3px 0 15px rgba(102, 126, 234, 0.4);
            z-index: 1000;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .chatbot-tab:hover {
            padding-right: 18px;
            box-shadow: -5px 0 20px rgba(102, 126, 234, 0.6);
        }
        .chatbot-tab svg {
            width: 20px;
            height: 20px;
            transform: rotate(90deg);
        }
        .chatbot-tab.hidden {
            display: none;
        }

        /* Chatbot Panel */
        .chatbot-panel {
            width: 0;
            min-width: 0;
            background: #f8f9fa;
            border-left: 1px solid #dee2e6;
            display: flex;
            flex-direction: column;
            transition: width 0.3s ease;
            overflow: hidden;
            position: relative;
        }
        .chatbot-panel.open {
            width: 30%;
            min-width: 300px;
        }

        /* Resize Handle */
        .resize-handle {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 6px;
            background: transparent;
            cursor: ew-resize;
            z-index: 100;
            transition: background 0.2s;
        }
        .resize-handle:hover,
        .resize-handle.dragging {
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
        }

        /* Chatbot Header */
        .chatbot-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        .chatbot-header h3 {
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .chatbot-header h3 svg {
            width: 22px;
            height: 22px;
        }
        .close-chatbot {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }
        .close-chatbot:hover {
            background: rgba(255,255,255,0.3);
        }
        .close-chatbot svg {
            width: 18px;
            height: 18px;
        }

        /* Chatbot Iframe Container */
        .chatbot-iframe-container {
            flex: 1;
            overflow: hidden;
        }
        .chatbot-iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Form Container */
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        .form-body {
            padding: 30px;
        }

        /* User Type Toggle */
        .user-type-toggle {
            background: linear-gradient(135deg, #e8f4f8 0%, #d1ecf1 100%);
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #bee5eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .user-type-toggle label {
            font-size: 14px;
            font-weight: 600;
            color: #0c5460;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .toggle-switch-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .toggle-label {
            font-size: 13px;
            font-weight: 500;
            color: #666;
            transition: color 0.3s;
        }
        .toggle-label.active {
            color: #1e3a5f;
            font-weight: 700;
        }
        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #28a745;
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .toggle-switch.employee {
            background: #dc3545;
        }
        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .toggle-switch.employee::after {
            transform: translateX(30px);
        }
        
        /* Customer Selector */
        .customer-selector {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border: 2px solid #dee2e6;
        }
        .customer-selector label {
            font-size: 14px;
            font-weight: 600;
            color: #1e3a5f;
            display: block;
            margin-bottom: 10px;
        }
        .customer-selector select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #1e3a5f;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        .customer-selector select:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(45, 90, 135, 0.2);
        }
        
        .section {
            margin-bottom: 30px;
        }
        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #1e3a5f;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e8ecf1;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }
        .form-row.single {
            grid-template-columns: 1fr;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        .form-group label {
            font-size: 13px;
            font-weight: 500;
            color: #555;
            margin-bottom: 6px;
        }
        .form-group input, .form-group select {
            padding: 12px 14px;
            border: 1px solid #dde2e8;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
            background: #fafbfc;
        }
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #2d5a87;
            background: white;
        }
        .form-group input[readonly] {
            background: #f0f2f5;
            color: #555;
        }
        
        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .status-good { background: #d4edda; color: #155724; }
        .status-delinquent { background: #f8d7da; color: #721c24; }
        .status-closed { background: #e2e3e5; color: #383d41; }
        
        /* Internal Section Divider */
        .internal-divider {
            margin: 10px 0 25px 0;
            position: relative;
            text-align: center;
        }
        .internal-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #dc3545, #dc3545, transparent);
        }
        .internal-divider-content {
            background: white;
            padding: 0 20px;
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        .internal-divider-content span {
            color: #dc3545;
            font-weight: 700;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* Internal Section */
        .internal-section {
            background: linear-gradient(135deg, #fff5f5 0%, #ffe8e8 100%);
            border: 2px dashed #dc3545;
            border-radius: 10px;
            padding: 25px;
            margin-top: 15px;
            transition: all 0.3s ease;
        }
        .internal-section.hidden {
            display: none;
        }
        .internal-section h3 {
            color: #dc3545;
            font-size: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .internal-section h3::before {
            content: 'üîí';
        }
        
        /* Risk Indicators */
        .risk-factors {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        .risk-item {
            text-align: center;
            padding: 18px 15px;
            background: white;
            border-radius: 10px;
            border: 1px solid #f5c6cb;
            box-shadow: 0 2px 8px rgba(220, 53, 69, 0.1);
        }
        .risk-item .value {
            font-size: 24px;
            font-weight: 700;
            color: #1e3a5f;
        }
        .risk-item .value.score-good { color: #28a745; }
        .risk-item .value.score-fair { color: #ffc107; }
        .risk-item .value.score-poor { color: #dc3545; }
        .risk-item .label {
            font-size: 11px;
            color: #777;
            margin-top: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Risk Assessment Box */
        .risk-assessment {
            background: white;
            border-radius: 8px;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #f5c6cb;
        }
        .risk-label {
            font-weight: 600;
            color: #555;
        }
        .risk-level {
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 13px;
            text-transform: uppercase;
        }
        .risk-low { background: #d4edda; color: #155724; }
        .risk-medium { background: #fff3cd; color: #856404; }
        .risk-high { background: #f8d7da; color: #721c24; }
        
        /* Button Container */
        .button-container {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        .submit-btn {
            flex: 1;
            padding: 14px;
            background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(30, 58, 95, 0.3);
        }
        
        .print-btn {
            flex: 1;
            padding: 14px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .print-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }
        .print-btn svg {
            width: 20px;
            height: 20px;
        }
        
        .app-id {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            display: inline-block;
            margin-top: 10px;
        }

        /* Print timestamp */
        .print-timestamp {
            display: none;
            text-align: right;
            font-size: 11px;
            color: #666;
            margin-bottom: 10px;
        }

        /* Signature Section */
        .signature-section {
            display: none;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #ddd;
        }
        .signature-row {
            display: flex;
            justify-content: space-between;
            gap: 50px;
            margin-top: 20px;
        }
        .signature-box {
            flex: 1;
        }
        .signature-line {
            border-bottom: 1px solid #333;
            height: 50px;
            margin-bottom: 8px;
        }
        .signature-label {
            font-size: 12px;
            color: #555;
        }

        /* Employee Only Section Container */
        .employee-only-section {
            display: none;
        }
        .employee-only-section.visible {
            display: block;
        }

        /* Account Standing Section inside internal */
        .account-standing-internal {
            margin-bottom: 25px;
        }
        .account-standing-internal .section-title {
            color: #dc3545;
            border-bottom-color: #f5c6cb;
        }

        /* ============================================
           PRINT STYLES
           ============================================ */
        @media print {
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            body {
                background: white;
                padding: 0;
                font-size: 11px;
            }

            .main-wrapper {
                display: block;
                height: auto;
                overflow: visible;
            }

            .form-panel {
                overflow: visible;
                padding: 0;
            }

            .chatbot-tab,
            .chatbot-panel {
                display: none !important;
            }
            
            .container {
                box-shadow: none;
                max-width: 100%;
                border-radius: 0;
            }
            
            .header {
                background: #1e3a5f !important;
                -webkit-print-color-adjust: exact;
                padding: 20px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            /* Hide interactive elements */
            .customer-selector,
            .user-type-toggle,
            .button-container,
            .no-print {
                display: none !important;
            }
            
            /* Show print-only elements */
            .print-timestamp,
            .signature-section {
                display: block !important;
            }
            
            /* Show internal section when printing if employee view */
            .employee-only-section.visible {
                display: block !important;
            }
            
            .internal-section {
                background: #fff5f5 !important;
                border: 2px dashed #dc3545 !important;
            }
            
            .internal-section h3::before {
                content: 'üîí ';
            }
            
            /* Ensure form styling prints properly */
            .form-body {
                padding: 20px;
            }
            
            .section {
                margin-bottom: 20px;
            }
            
            .form-group input,
            .form-group select {
                border: 1px solid #ccc !important;
                background: #f9f9f9 !important;
                padding: 8px 10px;
            }
            
            .status-badge {
                border: 1px solid currentColor;
            }
            
            .status-good {
                background: #d4edda !important;
                color: #155724 !important;
            }
            
            .status-delinquent {
                background: #f8d7da !important;
                color: #721c24 !important;
            }
            
            .status-closed {
                background: #e2e3e5 !important;
                color: #383d41 !important;
            }
            
            .risk-item {
                background: white !important;
                border: 1px solid #ddd !important;
            }
            
            .risk-item .value.score-good { color: #28a745 !important; }
            .risk-item .value.score-fair { color: #cc9a00 !important; }
            .risk-item .value.score-poor { color: #dc3545 !important; }
            
            .risk-low {
                background: #d4edda !important;
                color: #155724 !important;
            }
            
            .risk-medium {
                background: #fff3cd !important;
                color: #856404 !important;
            }
            
            .risk-high {
                background: #f8d7da !important;
                color: #721c24 !important;
            }

            /* Page break control */
            .section {
                page-break-inside: avoid;
            }
            
            .internal-section {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="main-wrapper">
        <!-- Form Panel -->
        <div class="form-panel" id="formPanel">
            <div class="container">
                <div class="header">
                    <h1>Loan Application Form</h1>
                    <p>Personal Loan Risk Assessment</p>
                    <div class="app-id" id="appId">Application ID: LA-2025-006666</div>
                </div>
                
                <div class="form-body">
                    <!-- Print Timestamp (only shows when printing) -->
                    <div class="print-timestamp" id="printTimestamp"></div>

                    <!-- User Type Toggle -->
                    <div class="user-type-toggle">
                        <label>
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            View Mode
                        </label>
                        <div class="toggle-switch-container">
                            <span class="toggle-label active" id="customerLabel">Customer</span>
                            <div class="toggle-switch" id="userTypeToggle" onclick="toggleUserType()"></div>
                            <span class="toggle-label" id="employeeLabel">Employee</span>
                        </div>
                    </div>

                    <!-- Customer Selector -->
                    <div class="customer-selector">
                        <label>üë§ Select Customer</label>
                        <select id="customerSelect" onchange="loadCustomerData()">
                            <option value="">-- Select a Customer --</option>
                            <option value="george" selected>George (ID: 6666)</option>
                            <option value="jonny">Jonny (ID: 7777)</option>
                            <option value="shufeng">Shufeng (ID: 8888)</option>
                        </select>
                    </div>

                    <!-- Personal Information -->
                    <div class="section">
                        <div class="section-title">Personal Information</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Full Name</label>
                                <input type="text" id="fullName" value="George Lim" readonly>
                            </div>
                            <div class="form-group">
                                <label>NRIC / ID Number</label>
                                <input type="text" id="nric" value="S6664567J" readonly>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Email Address</label>
                                <input type="email" id="email" value="george@gmail.com" readonly>
                            </div>
                            <div class="form-group">
                                <label>Phone Number</label>
                                <input type="tel" id="phone" value="+65 9123 6666">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nationality</label>
                                <input type="text" id="nationality" value="Singaporean" readonly>
                            </div>
                            <div class="form-group">
                                <label>Date of Birth</label>
                                <input type="date" id="dob" value="1975-03-22">
                            </div>
                        </div>
                        <div class="form-row single">
                            <div class="form-group">
                                <label>Residential Address</label>
                                <input type="text" id="address" value="Blk 456 Bedok North Ave 3, #12-789, Singapore 460456">
                            </div>
                        </div>
                    </div>

                    <!-- Employment Information -->
                    <div class="section">
                        <div class="section-title">Employment & Income</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Employment Status</label>
                                <select id="employmentStatus">
                                    <option value="fulltime" selected>Full-time Employed</option>
                                    <option value="parttime">Part-time Employed</option>
                                    <option value="selfemployed">Self-employed</option>
                                    <option value="unemployed">Unemployed</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Employer Name</label>
                                <input type="text" id="employer" value="Grab Holdings">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Monthly Income (SGD)</label>
                                <input type="number" id="income" value="5500">
                            </div>
                            <div class="form-group">
                                <label>Years at Current Job</label>
                                <input type="number" id="yearsEmployed" value="2">
                            </div>
                        </div>
                    </div>

                    <!-- Loan Details -->
                    <div class="section">
                        <div class="section-title">Loan Request Details</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Loan Amount Requested (SGD)</label>
                                <input type="number" id="loanAmount" value="25000">
                            </div>
                            <div class="form-group">
                                <label>Loan Purpose</label>
                                <select id="loanPurpose">
                                    <option value="renovation">Home Renovation</option>
                                    <option value="consolidation" selected>Debt Consolidation</option>
                                    <option value="education">Education</option>
                                    <option value="medical">Medical Expenses</option>
                                    <option value="business">Business</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Preferred Tenure (Months)</label>
                                <select id="tenure">
                                    <option value="12">12</option>
                                    <option value="24">24</option>
                                    <option value="36">36</option>
                                    <option value="48" selected>48</option>
                                    <option value="60">60</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Existing Monthly Obligations (SGD)</label>
                                <input type="number" id="obligations" value="2800">
                            </div>
                        </div>
                    </div>

                    <!-- Employee Only Section -->
                    <div class="employee-only-section" id="employeeOnlySection">
                        <!-- Internal Use Divider -->
                        <div class="internal-divider">
                            <div class="internal-divider-content">
                                <span>‚ö†Ô∏è Internal Use Only - Banking Staff</span>
                            </div>
                        </div>

                        <!-- Account Standing (Internal) -->
                        <div class="section account-standing-internal">
                            <div class="section-title">Account Standing</div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Customer ID</label>
                                    <input type="text" id="customerId" value="6666" readonly>
                                </div>
                                <div class="form-group">
                                    <label>Current Account Status</label>
                                    <div style="padding-top: 8px;">
                                        <span class="status-badge status-closed" id="statusBadge">Closed</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Internal Banking Section -->
                        <div class="internal-section" id="internalSection">
                            <h3>Risk Assessment Indicators</h3>
                            <div class="risk-factors">
                                <div class="risk-item">
                                    <div class="value score-fair" id="creditScore">550</div>
                                    <div class="label">Credit Score</div>
                                </div>
                                <div class="risk-item">
                                    <div class="value" id="dti">51%</div>
                                    <div class="label">Debt-to-Income</div>
                                </div>
                                <div class="risk-item">
                                    <div class="value" id="incomeMultiple">4.5x</div>
                                    <div class="label">Income Multiple</div>
                                </div>
                            </div>
                            <div class="risk-assessment">
                                <span class="risk-label">Overall Risk Assessment:</span>
                                <span class="risk-level risk-high" id="riskLevel">High Risk</span>
                            </div>
                        </div>
                    </div>

                    <!-- Signature Section (only shows when printing) -->
                    <div class="signature-section">
                        <div class="section-title">Authorization & Signatures</div>
                        <div class="signature-row">
                            <div class="signature-box">
                                <div class="signature-line"></div>
                                <div class="signature-label">Applicant Signature & Date</div>
                            </div>
                            <div class="signature-box">
                                <div class="signature-line"></div>
                                <div class="signature-label">Bank Officer Signature & Date</div>
                            </div>
                        </div>
                    </div>

                    <!-- Buttons -->
                    <div class="button-container">
                        <button type="submit" class="submit-btn">Submit for Risk Analysis</button>
                        <button type="button" class="print-btn" onclick="printToPDF()">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
                            </svg>
                            Print to PDF
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chatbot Toggle Tab -->
        <div class="chatbot-tab" id="chatbotTab" onclick="openChatbot()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
            </svg>
            AI Chat Assistant
        </div>

        <!-- Chatbot Panel -->
        <div class="chatbot-panel" id="chatbotPanel">
            <div class="resize-handle" id="resizeHandle"></div>
            <div class="chatbot-header">
                <h3>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                    </svg>
                    AI Chat Assistant
                </h3>
                <button class="close-chatbot" onclick="closeChatbot()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="chatbot-iframe-container">
                <iframe 
                    id="chatbotIframe"
                    src="https://n8n-railway-custom-production-be34.up.railway.app/webhook/ad2bd9e0-ef4f-4fdf-a92f-2d4f1a4c5f0f/chat"
                    allow="microphone"
                ></iframe>
            </div>
        </div>
    </div>

    <script>
        // Track current user type
        let isEmployee = false;
        let isChatbotOpen = false;

        // Customer Data with actual credit scores from the database
        const customers = {
            george: {
                id: '6666',
                name: 'George Lim',
                nric: 'S6664567J',
                email: 'george@gmail.com',
                phone: '+65 9123 6666',
                nationality: 'Singaporean',
                dob: '1975-03-22',
                address: 'Blk 456 Bedok North Ave 3, #12-789, Singapore 460456',
                employer: 'Grab Holdings',
                employmentStatus: 'fulltime',
                income: 5500,
                yearsEmployed: 2,
                loanAmount: 25000,
                loanPurpose: 'consolidation',
                tenure: '48',
                obligations: 2800,
                status: 'closed',
                statusClass: 'status-closed',
                statusText: 'Closed',
                creditScore: 550,
                scoreClass: 'score-fair',
                dti: '51%',
                incomeMultiple: '4.5x',
                riskLevel: 'High Risk',
                riskClass: 'risk-high'
            },
            jonny: {
                id: '7777',
                name: 'Jonny Tan',
                nric: 'S7774567J',
                email: 'jonny@gmail.com',
                phone: '+65 9123 7777',
                nationality: 'Singaporean',
                dob: '1982-11-08',
                address: 'Blk 789 Tampines St 21, #05-123, Singapore 520789',
                employer: 'Freelance',
                employmentStatus: 'selfemployed',
                income: 4200,
                yearsEmployed: 1,
                loanAmount: 20000,
                loanPurpose: 'business',
                tenure: '36',
                obligations: 1800,
                status: 'delinquent',
                statusClass: 'status-delinquent',
                statusText: 'Delinquent',
                creditScore: 450,
                scoreClass: 'score-poor',
                dti: '43%',
                incomeMultiple: '4.8x',
                riskLevel: 'High Risk',
                riskClass: 'risk-high'
            },
            shufeng: {
                id: '8888',
                name: 'Shufeng Tan',
                nric: 'S8884567J',
                email: 'shufeng@gmail.com',
                phone: '+65 9123 8888',
                nationality: 'Singaporean',
                dob: '1988-06-15',
                address: 'Blk 123 Ang Mo Kio Ave 4, #08-456, Singapore 560123',
                employer: 'DBS Bank Ltd',
                employmentStatus: 'fulltime',
                income: 8500,
                yearsEmployed: 4,
                loanAmount: 35000,
                loanPurpose: 'consolidation',
                tenure: '36',
                obligations: 1200,
                status: 'good-standing',
                statusClass: 'status-good',
                statusText: 'Good Standing',
                creditScore: 650,
                scoreClass: 'score-good',
                dti: '34%',
                incomeMultiple: '4.1x',
                riskLevel: 'Low Risk',
                riskClass: 'risk-low'
            }
        };

        function toggleUserType() {
            isEmployee = !isEmployee;
            const toggle = document.getElementById('userTypeToggle');
            const customerLabel = document.getElementById('customerLabel');
            const employeeLabel = document.getElementById('employeeLabel');
            const employeeSection = document.getElementById('employeeOnlySection');

            if (isEmployee) {
                toggle.classList.add('employee');
                customerLabel.classList.remove('active');
                employeeLabel.classList.add('active');
                employeeSection.classList.add('visible');
            } else {
                toggle.classList.remove('employee');
                customerLabel.classList.add('active');
                employeeLabel.classList.remove('active');
                employeeSection.classList.remove('visible');
            }
        }

        function loadCustomerData() {
            const select = document.getElementById('customerSelect');
            const customer = customers[select.value];
            
            if (!customer) return;

            // Update Application ID
            document.getElementById('appId').textContent = `Application ID: LA-2025-00${customer.id}`;

            // Personal Information
            document.getElementById('fullName').value = customer.name;
            document.getElementById('nric').value = customer.nric;
            document.getElementById('email').value = customer.email;
            document.getElementById('phone').value = customer.phone;
            document.getElementById('nationality').value = customer.nationality;
            document.getElementById('dob').value = customer.dob;
            document.getElementById('address').value = customer.address;

            // Employment
            document.getElementById('employer').value = customer.employer;
            document.getElementById('employmentStatus').value = customer.employmentStatus;
            document.getElementById('income').value = customer.income;
            document.getElementById('yearsEmployed').value = customer.yearsEmployed;

            // Loan Details
            document.getElementById('loanAmount').value = customer.loanAmount;
            document.getElementById('loanPurpose').value = customer.loanPurpose;
            document.getElementById('tenure').value = customer.tenure;
            document.getElementById('obligations').value = customer.obligations;

            // Account Status
            document.getElementById('customerId').value = customer.id;
            const statusBadge = document.getElementById('statusBadge');
            statusBadge.className = `status-badge ${customer.statusClass}`;
            statusBadge.textContent = customer.statusText;

            // Internal Risk Data
            const creditScoreEl = document.getElementById('creditScore');
            creditScoreEl.textContent = customer.creditScore;
            creditScoreEl.className = `value ${customer.scoreClass}`;
            
            document.getElementById('dti').textContent = customer.dti;
            document.getElementById('incomeMultiple').textContent = customer.incomeMultiple;

            const riskLevelEl = document.getElementById('riskLevel');
            riskLevelEl.textContent = customer.riskLevel;
            riskLevelEl.className = `risk-level ${customer.riskClass}`;
        }

        function printToPDF() {
            // Set print timestamp
            const now = new Date();
            const timestamp = now.toLocaleString('en-SG', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('printTimestamp').textContent = `Generated: ${timestamp}`;
            
            // Trigger print dialog
            window.print();
        }

        // Chatbot Functions
        function openChatbot() {
            const panel = document.getElementById('chatbotPanel');
            const tab = document.getElementById('chatbotTab');
            
            panel.classList.add('open');
            tab.classList.add('hidden');
            isChatbotOpen = true;
        }

        function closeChatbot() {
            const panel = document.getElementById('chatbotPanel');
            const tab = document.getElementById('chatbotTab');
            
            panel.classList.remove('open');
            panel.style.width = '';
            tab.classList.remove('hidden');
            isChatbotOpen = false;
        }

        // Resize Handle Functionality
        const resizeHandle = document.getElementById('resizeHandle');
        const chatbotPanel = document.getElementById('chatbotPanel');
        const mainWrapper = document.querySelector('.main-wrapper');

        let isResizing = false;
        let startX;
        let startWidth;

        resizeHandle.addEventListener('mousedown', (e) => {
            isResizing = true;
            startX = e.clientX;
            startWidth = chatbotPanel.offsetWidth;
            resizeHandle.classList.add('dragging');
            document.body.style.cursor = 'ew-resize';
            document.body.style.userSelect = 'none';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isResizing) return;
            
            const diff = startX - e.clientX;
            const newWidth = startWidth + diff;
            const windowWidth = window.innerWidth;
            
            // Limit width between 250px and 60% of window
            const minWidth = 250;
            const maxWidth = windowWidth * 0.6;
            
            if (newWidth >= minWidth && newWidth <= maxWidth) {
                chatbotPanel.style.width = newWidth + 'px';
            }
        });

        document.addEventListener('mouseup', () => {
            if (isResizing) {
                isResizing = false;
                resizeHandle.classList.remove('dragging');
                document.body.style.cursor = '';
                document.body.style.userSelect = '';
            }
        });

        // Initialize with George's data
        document.addEventListener('DOMContentLoaded', function() {
            loadCustomerData();
        });
    </script>
</body>
</html>
